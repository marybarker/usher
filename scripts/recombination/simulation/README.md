# Recombination Simulation

This repository contains scripts to create a multiple-sequence alignment of recombinant genomes. It was designed to test the recombination module in [UShER](https://usher-wiki.readthedocs.io/en/latest/), but may be used for other purposes as well.

Note: I have been using specifically commit a6f65ade7a6606ef75902ee290585c6db23aeba6 as after this, the format for the output of `matUtils extract -S` has changed. To get this version of user, you can use `wget https://github.com/yatisht/usher/archive/a6f65ade7a6606ef75902ee290585c6db23aeba6.zip` and follow the remainder of the install instructions at [the UShER Wiki](https://usher-wiki.readthedocs.io/en/latest/).

## Summary:

### makeMutsFile.py
generates a MSA of all nodes of interest. By default, this will produce a diff file for each internal node with at least 10 descendants, but you may set -t to 0 to get this for all internal nodes and leaves, or set -f to output a full MSA as well.

the internal nodes from the initial tree with at least 10 descendants.  
Options:
- -s (--samples): Sample mutation paths file, generated by e.g. *matUtils extract -i <input.pb> -A <sample-paths.tsv>*.  
- -l (--leaves): Leaves per node, generated by e.g. *matUtils extract -i <input.pb> -L <num-leaves.tsv>*.  
- -t (--threshold): By default, this script includes only nodes with at least 10 descendant leaves. To use a different minimum, specify here. (Default = 10).  
- -r (--reference): Reference genome, used to generate VCF. Default = 'wuhan.ref.fa' (in this repository, corresponds to [the reference genome of SARS-CoV-2](https://www.ncbi.nlm.nih.gov/nuccore/1798174254) with [problematic sites](https://raw.githubusercontent.com/W-L/ProblematicSites_SARS-CoV2/master/problematic_sites_sarsCov2.vcf) masked.).
- -f (--fasta): Write fasta file containing all samples according to their mutation paths. This makes the script significantly slower. (Default = False)  

### makeRandomRecombinants.py
generates a MSA of recombinant samples from the internal node sequences.  
Options:
- -b (--breakpoints): Number of breakpoints that each recombinant sample will have. Must be 1 or 2 (Default = 1).  
- -s (--samples): Number of recombinant samples to create (Default = 100).  
- -c (--copies): Number of identical copies to make for each recombinant sample (Default = 10).  
- -d (--differences): Minimum mutational distance for acceptor/donor samples (Default = 10).  
- -m (--commonMutations): Number of mutations to add to each copy, shared by all in a set. (Default = 0).  
- -M (--randomMutations): Number of mutations to add to each copy, randomly chosen for each copy. (Default = 0).  
- -f (--fasta): Fasta file containing sequences for acceptor/donor samples. [REQUIRED]  
- -r (--reference): Fasta file containing reference genome for use in creating VCF. (Default = 'wuhan.ref.fa').  
- -S (--separate): If enabled, will produce one MSA as a .fasta file for each set of recombinants to the argument directory. If not enabled, will not produce these files.  

## Example pipeline:

```
matUtils extract -i input.pb -S samples.tsv -L num_leaves.tsv
python makeMutsFile.py -s samples.tsv -l num-leaves.txt -t 10 -r wuhan.ref.fa  
python makeRandomRecombinants.py -b 1 -s 100 -c 10 -t 10 -d allNodeToMutsT10.txt -r wuhan.ref.fa -S 1BP_0M_10C
faToVcf recombination_1.msa.fa recombination_1.msa.vcf
usher -i input.pb -v recombination_1.msa.vcf -o recombination_1.msa.pb
findRecombination -i recombination_1.msa.pb
```
